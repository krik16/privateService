<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="com.rongyi.tms.mapper.xml.PayMapper">
    <resultMap id="BaseResultMap" type="com.rongyi.easy.tms.vo.TradeVO">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="order_time" property="orderTime" jdbcType="TIMESTAMP"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="draw_user_id" property="drawUserId" jdbcType="VARCHAR"/>
        <result column="order_price" property="orderPrice" jdbcType="DECIMAL"/>
        <result column="order_no" property="orderNo" jdbcType="VARCHAR"/>
        <result column="pay_no" property="payNo" jdbcType="VARCHAR"/>
        <result column="shop_id" property="shopId" jdbcType="VARCHAR"/>
        <result column="shop_name" property="shopName" jdbcType="VARCHAR"/>
        <result column="mall_id" property="mallId" jdbcType="VARCHAR"/>
        <result column="mall_name" property="mallName" jdbcType="VARCHAR"/>
        <result column="seller_account" property="sellerAccount"
                jdbcType="VARCHAR"/>
        <result column="seller_name" property="sellerName" jdbcType="VARCHAR"/>
        <result column="trade_type" property="tradeType" jdbcType="VARCHAR"/>
        <result column="pay_channel" property="payChannel" jdbcType="INTEGER"/>
        <result column="draw_apply_id" property="drawApplyId" jdbcType="INTEGER"/>
        <result column="guide_type" property="guideType" jdbcType="INTEGER"/>
        <result column="op_time" property="opTime" jdbcType="TIMESTAMP"/>
    </resultMap>
    <sql id="Base_Column_List">
        `payment_order`.`id` AS `id`,`payment_order`.`create_at` AS `order_time`,`payment_order`.`status` AS
        `status`,`payment_order`.`draw_user_id` AS `draw_user_id`,`payment_order`.`pay_amount` AS
        `order_price`,`payment_order`.`order_no` AS `order_no`,`payment_order`.`order_type` AS
        `order_type`,`payment_order`.`pay_no` AS `pay_no`,`payment_order`.`trade_type` AS
        `trade_type`,`payment_order`.`pay_channel` AS `pay_channel`,`draw_apply`.`id` AS
        `draw_apply_id`,`draw_apply`.`shop_id` AS `shop_id`,`draw_apply`.`shop_name` AS
        `shop_name`,`draw_apply`.`mall_id` AS `mall_id`,`draw_apply`.`mall_name` AS
        `mall_name`,`draw_apply`.`seller_account` AS `seller_account`,`draw_apply`.`seller_name` AS `seller_name`,guide_type,
         op.op_time
    </sql>
    <sql id="Base_from">
        payment_order
        left join draw_apply on draw_apply.draw_no = payment_order.order_no
        LEFT JOIN ry_rmmm.shop_info shop_info on shop_info.id = draw_apply.shop_id
        left join payment_order_op op on op.payment_id = payment_order.id
    </sql>
    <sql id="trade_list_where_clause">
        <!-- 订单号 -->
        <if test="orderNo != null and orderNo != ''">
            AND payment_order.order_no = #{orderNo}
        </if>
        <!-- 商场名称 -->
        <if test="mallName != null and mallName != ''">
            AND draw_apply.mall_name like
            concat('%',#{mallName,jdbcType=VARCHAR},'%')
        </if>
        <!-- 店铺名称 -->
        <if test="shopName != null and shopName != ''">
            AND draw_apply.shop_name like
            concat('%',#{shopName,jdbcType=VARCHAR},'%')
        </if>
        <!-- 街边店铺id -->
        <if test="curbshopId != null and curbshopId != ''">
            AND shop_info.shop_mid = #{curbshopId}
        </if>
        <!-- 卖家姓名 -->
        <if test="sellerName != null and sellerName != ''">
            AND draw_apply.seller_name like
            concat('%',#{sellerName,jdbcType=VARCHAR},'%')
        </if>
        <!-- 状态 -->
        <if test="status != null">
            AND payment_order.status = #{status}
        </if>

        <!-- 交易类型 -->
        <if test="tradeType != null and tradeType != ''">
            AND payment_order.trade_type = #{tradeType}
        </if>
        <if test="tradeType == null || tradeType == ''">
            AND payment_order.trade_type = 3
        </if>
        <!-- 付款方式-->
        <if test="payChannel != null and payChannel != ''">
            AND payment_order.pay_channel = #{payChannel}
        </if>

        <!-- 提现申请时间 -->
        <if test="tradeStartTime != null and tradeStartTime != ''">
            AND payment_order.create_at >= #{tradeStartTime}
        </if>
        <if test="tradeEndTime != null and tradeEndTime != ''">
            AND #{tradeEndTime} >= payment_order.create_at
        </if>
        <!-- 交易金额 -->
        <if test="minTotalPrice != null and minTotalPrice != ''">
            AND payment_order.pay_amount >= #{minTotalPrice}
        </if>
        <if test="maxTotalPrice != null and maxTotalPrice != ''">
            AND #{maxTotalPrice} >= payment_order.pay_amount
            AND #{maxTotalPrice} >= payment_order.pay_amount
        </if>
        <!-- 渠道 -->
        <if test="guideType != null and guideType != ''">
            AND guide_type = #{guideType}
        </if>
    </sql>
    <select id="selectPayPageList" resultMap="BaseResultMap"
            parameterType="java.lang.Integer">
        select
        <include refid="Base_Column_List"/>
        from
        <include refid="Base_from"/>
        <where>
            <include refid="trade_list_where_clause"/>
        </where>
        <if test="orderby != null">
            order by ${orderby} ${orderVa}
        </if>

        <if test="orderby == null">
            order by payment_order.create_at desc
        </if>

        limit #{currentPage,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
    </select>
    <select id="selectPayPageListCount" parameterType="java.util.Map"
            resultType="java.lang.Integer">
        select count(payment_order.id) from
        <include refid="Base_from"/>
        <where>
            <include refid="trade_list_where_clause"/>
        </where>
    </select>

</mapper>