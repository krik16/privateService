<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="com.rongyi.tms.mapper.xml.v2.SalesCommissionMapper" >
  <resultMap id="BaseResultMap" type="com.rongyi.easy.tms.entity.v2.SalesCommission" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="guide_id" property="guideId" jdbcType="VARCHAR" />
    <result column="order_no" property="orderNo" jdbcType="VARCHAR" />
    <result column="commission_amount" property="commissionAmount" jdbcType="DECIMAL" />
    <result column="status" property="status" jdbcType="TINYINT" />
    <result column="create_at" property="createAt" jdbcType="TIMESTAMP" />
    <result column="type" property="type" jdbcType="TINYINT" />
    <result column="pic_upload_at" property="picUploadAt" jdbcType="TIMESTAMP" />
    <result column="create_user" property="createUser" jdbcType="VARCHAR" />
    <result column="update_user" property="updateUser" jdbcType="VARCHAR" />
    <result column="update_at" property="updateAt" jdbcType="TIMESTAMP" />
    <result column="buyer_account" property="buyerAccount" jdbcType="VARCHAR" />
    <result column="seller_account" property="sellerAccount" jdbcType="VARCHAR" />
    <result column="version" property="version" jdbcType="BIGINT" />
    <result column="guide_type" property="guideType" jdbcType="INTEGER" />
    <result column="comm_no" property="commNo" jdbcType="VARCHAR" />
    <result column="config_id" property="configId" jdbcType="INTEGER" />
    <result column="invite_phone" property="invitePhone" jdbcType="VARCHAR" />
    <result column="register_phone" property="registerPhone" jdbcType="VARCHAR" />
    <result column="is_delete" property="isDelete" jdbcType="TINYINT" />
  </resultMap>
  <resultMap id="ResultMapWithBLOBs" type="com.rongyi.easy.tms.entity.v2.SalesCommission" extends="BaseResultMap" >
    <result column="pic_urls" property="picUrls" jdbcType="LONGVARBINARY" />
    <result column="remarks" property="remarks" jdbcType="LONGVARBINARY" />
  </resultMap>
  <resultMap id="FullResultMap" type="com.rongyi.easy.tms.vo.v2.SalesCommissionVO" extends="ResultMapWithBLOBs" >
    <result column="register_type" property="registerType" jdbcType="TINYINT" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, guide_id, order_no, commission_amount, `status`, create_at, `type`, pic_upload_at,
    create_user, update_user, update_at, buyer_account, seller_account, version, guide_type,
    comm_no, config_id, invite_phone, register_phone, is_delete
  </sql>
  <sql id="Blob_Column_List" >
    pic_urls, remarks
  </sql>
  <select id="selectByPrimaryKey" resultMap="ResultMapWithBLOBs" parameterType="java.lang.Integer" >
    select
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from sales_commission
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from sales_commission
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.rongyi.easy.tms.entity.v2.SalesCommission" useGeneratedKeys="true" keyProperty="id" >
    insert into sales_commission (guide_id, order_no, commission_amount,
      `status`, create_at, `type`,
      pic_upload_at, create_user, update_user,
      update_at, buyer_account, seller_account,
      version, guide_type, comm_no,
      config_id, invite_phone, register_phone,
      is_delete, pic_urls, remarks
      )
    values (#{guideId,jdbcType=VARCHAR}, #{orderNo,jdbcType=VARCHAR}, #{commissionAmount,jdbcType=DECIMAL},
      #{status,jdbcType=TINYINT}, #{createAt,jdbcType=TIMESTAMP}, #{type,jdbcType=TINYINT},
      #{picUploadAt,jdbcType=TIMESTAMP}, #{createUser,jdbcType=VARCHAR}, #{updateUser,jdbcType=VARCHAR},
      #{updateAt,jdbcType=TIMESTAMP}, #{buyerAccount,jdbcType=VARCHAR}, #{sellerAccount,jdbcType=VARCHAR},
      #{version,jdbcType=BIGINT}, #{guideType,jdbcType=INTEGER}, #{commNo,jdbcType=VARCHAR},
      #{configId,jdbcType=INTEGER}, #{invitePhone,jdbcType=VARCHAR}, #{registerPhone,jdbcType=VARCHAR},
      #{isDelete,jdbcType=TINYINT}, #{picUrls,jdbcType=LONGVARBINARY}, #{remarks,jdbcType=LONGVARBINARY}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.rongyi.easy.tms.entity.v2.SalesCommission" useGeneratedKeys="true" keyProperty="id" >
    insert into sales_commission
    <trim prefix="(" suffix=")" suffixOverrides="," >
      guide_id,
      order_no,
      commission_amount,
      `status`,
      create_at,
      `type`,
      pic_upload_at,
      create_user,
      update_user,
      update_at,
      buyer_account,
      seller_account,
      version,
      guide_type,
      comm_no,
      config_id,
      invite_phone,
      register_phone,
      is_delete,
      pic_urls,
      remarks,
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      #{guideId,jdbcType=VARCHAR},
      #{orderNo,jdbcType=VARCHAR},
      #{commissionAmount,jdbcType=DECIMAL},
      #{status,jdbcType=TINYINT},
      #{createAt,jdbcType=TIMESTAMP},
      #{type,jdbcType=TINYINT},
      #{picUploadAt,jdbcType=TIMESTAMP},
      #{createUser,jdbcType=VARCHAR},
      #{updateUser,jdbcType=VARCHAR},
      #{updateAt,jdbcType=TIMESTAMP},
      #{buyerAccount,jdbcType=VARCHAR},
      #{sellerAccount,jdbcType=VARCHAR},
      #{version,jdbcType=BIGINT},
      #{guideType,jdbcType=INTEGER},
      #{commNo,jdbcType=VARCHAR},
      #{configId,jdbcType=INTEGER},
      #{invitePhone,jdbcType=VARCHAR},
      #{registerPhone,jdbcType=VARCHAR},
      #{isDelete,jdbcType=TINYINT},
      #{picUrls,jdbcType=LONGVARBINARY},
      #{remarks,jdbcType=LONGVARBINARY},
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.rongyi.easy.tms.entity.v2.SalesCommission" >
    update sales_commission
    <set >
      <if test="guideId != null" >
        guide_id = #{guideId,jdbcType=VARCHAR},
      </if>
      <if test="orderNo != null" >
        order_no = #{orderNo,jdbcType=VARCHAR},
      </if>
      <if test="commissionAmount != null" >
        commission_amount = #{commissionAmount,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        `status` = #{status,jdbcType=TINYINT},
      </if>
      <if test="createAt != null" >
        create_at = #{createAt,jdbcType=TIMESTAMP},
      </if>
      <if test="type != null" >
        `type` = #{type,jdbcType=TINYINT},
      </if>
      <if test="picUploadAt != null" >
        pic_upload_at = #{picUploadAt,jdbcType=TIMESTAMP},
      </if>
      <if test="createUser != null" >
        create_user = #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="updateUser != null" >
        update_user = #{updateUser,jdbcType=VARCHAR},
      </if>
      <if test="updateAt != null" >
        update_at = #{updateAt,jdbcType=TIMESTAMP},
      </if>
      <if test="buyerAccount != null" >
        buyer_account = #{buyerAccount,jdbcType=VARCHAR},
      </if>
      <if test="sellerAccount != null" >
        seller_account = #{sellerAccount,jdbcType=VARCHAR},
      </if>
      <if test="version != null" >
        version = #{version,jdbcType=BIGINT},
      </if>
      <if test="guideType != null" >
        guide_type = #{guideType,jdbcType=INTEGER},
      </if>
      <if test="commNo != null" >
        comm_no = #{commNo,jdbcType=VARCHAR},
      </if>
      <if test="configId != null" >
        config_id = #{configId,jdbcType=INTEGER},
      </if>
      <if test="invitePhone != null" >
        invite_phone = #{invitePhone,jdbcType=VARCHAR},
      </if>
      <if test="registerPhone != null" >
        register_phone = #{registerPhone,jdbcType=VARCHAR},
      </if>
      <if test="isDelete != null" >
        is_delete = #{isDelete,jdbcType=TINYINT},
      </if>
      <if test="picUrls != null" >
        pic_urls = #{picUrls,jdbcType=LONGVARBINARY},
      </if>
      <if test="remarks != null" >
        remarks = #{remarks,jdbcType=LONGVARBINARY},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.rongyi.easy.tms.entity.v2.SalesCommission" >
    update sales_commission
    set guide_id = #{guideId,jdbcType=VARCHAR},
      order_no = #{orderNo,jdbcType=VARCHAR},
      commission_amount = #{commissionAmount,jdbcType=DECIMAL},
      `status` = #{status,jdbcType=TINYINT},
      create_at = #{createAt,jdbcType=TIMESTAMP},
      `type` = #{type,jdbcType=TINYINT},
      pic_upload_at = #{picUploadAt,jdbcType=TIMESTAMP},
      create_user = #{createUser,jdbcType=VARCHAR},
      update_user = #{updateUser,jdbcType=VARCHAR},
      update_at = #{updateAt,jdbcType=TIMESTAMP},
      buyer_account = #{buyerAccount,jdbcType=VARCHAR},
      seller_account = #{sellerAccount,jdbcType=VARCHAR},
      version = #{version,jdbcType=BIGINT},
      guide_type = #{guideType,jdbcType=INTEGER},
      comm_no = #{commNo,jdbcType=VARCHAR},
      config_id = #{configId,jdbcType=INTEGER},
      invite_phone = #{invitePhone,jdbcType=VARCHAR},
      register_phone = #{registerPhone,jdbcType=VARCHAR},
      is_delete = #{isDelete,jdbcType=TINYINT},
      pic_urls = #{picUrls,jdbcType=LONGVARBINARY},
      remarks = #{remarks,jdbcType=LONGVARBINARY}
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.rongyi.easy.tms.entity.v2.SalesCommission" >
    update sales_commission
    set guide_id = #{guideId,jdbcType=VARCHAR},
      order_no = #{orderNo,jdbcType=VARCHAR},
      commission_amount = #{commissionAmount,jdbcType=DECIMAL},
      `status` = #{status,jdbcType=TINYINT},
      create_at = #{createAt,jdbcType=TIMESTAMP},
      `type` = #{type,jdbcType=TINYINT},
      pic_upload_at = #{picUploadAt,jdbcType=TIMESTAMP},
      create_user = #{createUser,jdbcType=VARCHAR},
      update_user = #{updateUser,jdbcType=VARCHAR},
      update_at = #{updateAt,jdbcType=TIMESTAMP},
      buyer_account = #{buyerAccount,jdbcType=VARCHAR},
      seller_account = #{sellerAccount,jdbcType=VARCHAR},
      version = #{version,jdbcType=BIGINT},
      guide_type = #{guideType,jdbcType=INTEGER},
      comm_no = #{commNo,jdbcType=VARCHAR},
      config_id = #{configId,jdbcType=INTEGER},
      invite_phone = #{invitePhone,jdbcType=VARCHAR},
      register_phone = #{registerPhone,jdbcType=VARCHAR},
      is_delete = #{isDelete,jdbcType=TINYINT}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <sql id="Commission_List_Condition">
    <if test="status!=null">
      and sc.status=#{status}
    </if>
    <!-- 财务列表 -->
    <if test="searchType!=null and searchType=1">
      and sc.status not in(1, -1)
    </if>
    <if test="commNo!=null and commNo!=''">
      and sc.comm_no=#{commNo}
    </if>
    <if test="createAtBegin!=null and createAtBegin!=''">
      and sc.create_at &gt;#{createAtBegin}
    </if>
    <if test="createAtEnd!=null and createAtEnd!=''">
      and sc.create_at &lt;#{createAtEnd}
    </if>
    <if test="registerPhone!=null and registerPhone!=''">
      and sc.register_phone == #{registerPhone}
    </if>
    <if test="invitePhone!=null and invitePhone!=''">
      and sc.invite_phone == #{invitePhone}
    </if>
    <if test="commissionAmountBegin!=null and commissionAmountBegin!=''">
      and sc.commission_amount &gt; #{commissionAmountBegin}
    </if>
    <if test="commissionAmountEnd!=null and commissionAmountEnd!=''">
      and sc.commission_amount &lt; #{commissionAmountEnd}
    </if>
    <if test="guideType!=null and guideType!=0">
      and sc.guide_type == #{guideType}
    </if>
    <if test="orderNos!=null and orderNos.size()>0">
      and sc.order_no in<foreach collection="orderNos" item="item" open="(" separator="," close=")">#{item}</foreach>
    </if>
    <if test="registerType!=null and registerType!=0">
      and cc.register_type == #{registerType}
    </if>
    <if test="type!=null">
      and cc.type=#{type}
    </if>
  </sql>
  
  <select id="findCommissionList" parameterType="map" resultMap="FullResultMap">
    select sc.*, cc.register_type, cc.type from sales_commission sc join commission_config cc on sc.config_id=cc.id
    <where>
      <include refid="Commission_List_Condition"/>
    </where>
    order by sc.create_at desc
    limit #{startRecord, jdbcType=INTEGER}, #{pageSize, jdbcType=INTEGER}
  </select>
  <select id="countSalesCommission" parameterType="map" resultType="int">
    select count(1) from sales_commission sc join commission_config cc on sc.config_id=cc.id
    <where>
      <include refid="Commission_List_Condition"/>
    </where>
  </select>
  <select id="getCommissionDetail" parameterType="map" resultMap="FullResultMap">
    select sc.*, cc.register_type, cc.type
    from sales_commission sc join commission_config cc on sc.config_id=cc.id
    where sc.id=#{id}
  </select>
  <select id="selectDailyCount" parameterType="map" resultType="int">
    select count(1) from sales_commission sc join commission_config cc on sc.config_id=cc.id
    where TO_DAYS(sc.create_at)=TO_DAYS(#{createAt, jdbcType=TIMESTAMP})
          and sc.guide_id=#{guideId, jdbcType=INTEGER}
          and sc.status=3
          and cc.type=#{type, jdbcType=TINYINT}
  </select>
</mapper>