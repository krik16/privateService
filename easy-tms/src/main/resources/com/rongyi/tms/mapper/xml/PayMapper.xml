<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="com.rongyi.tms.mapper.xml.PayMapper">
	<resultMap id="BaseResultMap" type="com.rongyi.easy.tms.vo.TradeVO">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="order_time" property="orderTime" jdbcType="TIMESTAMP" />
		<result column="status" property="status" jdbcType="INTEGER" />
		<result column="draw_user_id" property="drawUserId" jdbcType="VARCHAR" />
		<result column="order_price" property="orderPrice" jdbcType="DECIMAL" />
		<result column="order_no" property="orderNo" jdbcType="VARCHAR" />
		<result column="pay_no" property="payNo" jdbcType="VARCHAR" />
		<result column="shop_id" property="shopId" jdbcType="VARCHAR" />
		<result column="shop_name" property="shopName" jdbcType="VARCHAR" />
		<result column="mall_id" property="mallId" jdbcType="VARCHAR" />
		<result column="mall_name" property="mallName" jdbcType="VARCHAR" />
		<result column="seller_account" property="sellerAccount"
			jdbcType="VARCHAR" />
		<result column="seller_name" property="sellerName" jdbcType="VARCHAR" />
		<result column="trade_type" property="tradeType" jdbcType="VARCHAR" />
		<result column="pay_channel" property="payChannel" jdbcType="INTEGER" />
		<result column="draw_apply_id" property="drawApplyId" jdbcType="INTEGER" />
	</resultMap>
	<sql id="Base_Column_List">
		id, order_time, `status`, draw_user_id, order_price,
		order_no, pay_no,
		shop_id,
		shop_name, mall_id, mall_name,
		seller_account,trade_type,
		seller_name,pay_channel,draw_apply_id
	</sql>
	<sql id="trade_list_where_clause">
		<!-- 订单号 -->
		<if test="orderNo != null and orderNo != ''">
			AND order_no = #{orderNo}
		</if>
		<!-- 商场名称 -->
		<if test="mallName != null and mallName != ''">
			AND mall_name like
			concat('%',#{mallName,jdbcType=VARCHAR},'%')
		</if>
		<!-- 店铺名称 -->
		<if test="shopName != null and shopName != ''">
			AND shop_name like
			concat('%',#{shopName,jdbcType=VARCHAR},'%')
		</if>
		<!-- 卖家姓名 -->
		<if test="sellerName != null and sellerName != ''">
			AND seller_name like
			concat('%',#{sellerName,jdbcType=VARCHAR},'%')
		</if>
		<!-- 状态 -->
		<if test="status != null and status != ''">
			AND status = #{status}
		</if>

		<!-- 交易类型 -->
		<if test="tradeType != null and tradeType != ''">
			AND trade_type = #{tradeType}
		</if>
		<if test="tradeType == null || tradeType == ''">
			AND trade_type = 3
		</if>
		<!-- 付款方式-->
		<if test="payChannel != null and payChannel != ''">
			AND pay_channel = #{payChannel}
		</if>

		<!-- 提现申请时间 -->
		<if test="tradeStartTime != null and tradeStartTime != ''">
			AND order_time >= #{tradeStartTime}
		</if>
		<if test="tradeEndTime != null and tradeEndTime != ''">
			AND #{tradeEndTime} >= order_time
		</if>
		<!-- 交易金额 -->
		<if test="minTotalPrice != null and minTotalPrice != ''">
			AND order_price >= #{minTotalPrice}
		</if>
		<if test="maxTotalPrice != null and maxTotalPrice != ''">
			AND #{maxTotalPrice} >= order_price
		</if>

	</sql>
	<select id="selectPayPageList" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from pay_view
		<where>
			<include refid="trade_list_where_clause" />
		</where>
		<if test="orderby != null">
			order by ${orderby} ${orderVa}
		</if>

		<if test="orderby == null">
			order by order_time desc
		</if>

		limit #{currentPage,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
	</select>
	<select id="selectPayPageListCount" parameterType="java.util.Map"
		resultType="java.lang.Integer">
		select count(id) from pay_view
		<where>
			<include refid="trade_list_where_clause" />
		</where>
	</select>

</mapper>